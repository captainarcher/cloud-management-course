# Logging Activity
**** IN PROGRESS - NOT READY FOR STUDENTS YET ****

You are required to complete this ungraded activity.

In this activity, you will set up the Elastic Stack (ELK) to capture data from Metricbeat on your Linux VM.  Software like the Elastic Stack is used to understand the vast amounts of data generated by a business' information systems.

We will be focused on Metricbeat for this activity, but an extra credit assignment will be posted that will enable you to expand upon what you learned.  The details will be made available soon.

**Follow the instructions for your chosen Linux distribution**
<br>

## Instructions for Ubuntu/Debian Linux
1. Install Java on your Linux machine.  OpenJDK 14 or 15 are required.  Use this command to install Open JDK 14.
```
sudo apt install openjdk-14-jre-headless
```
2. Download [Elasticsearch](https://www.elastic.co/products/elasticsearch).
```
curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-amd64.deb
```
Note: if you do not have curl installed, use ```sudo apt install curl``` to install it.<br>
3. Install Elasticsearch
```
sudo dpkg -i elasticsearch-7.9.3-amd64.deb
```
4. Start elasticsearch
```
sudo /etc/init.d/elasticsearch start
```
5. Open up network access to your Linux virtual machine from the Internet for Elastic Stack (ELK) ports.  You will need to open these ports for the Public IP Address of your Linux VM: 9200, 5601

**GCP Firewall Opening Instructions:**<br>
**AWS Firewall Opening Instructions:**

Note: If your Linux VM does not yet have a public IP, then follow these instructions for adding one.
<br>
**GCP Public IP Setup Instructions:**<br>
**AWS Public IP Setup Instructions:**<br>

6. Ensure that Elasticsearch is running on port 9200.

First, test from your Linux VM:
```
curl http://127.0.0.1:9200
```

Next, test from your computer's browser.  http://YOURPUBLICIP:9200

Replace "YOURPUBLICIP" with the actual Public IP for your VM instance.

Hint: your Public IP will NOT be an address that starts with 10, 172, or 192.  If you have an IP that starts with one of those numbers, that is your Private IP.  Go back a step and read the instructions carefully before proceeding.

Your tests should show a result similar to this example:
```
{
  "name" : "QtI5dUu",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "DMXhqzzjTGqEtDlkaMOzlA",
  "version" : {
    "number" : "7.9.3",
    "build_flavor" : "default",
    "build_type" : "tar",
    "build_hash" : "00d8bc1",
    "build_date" : "2018-06-06T16:48:02.249996Z",
    "build_snapshot" : false,
    "lucene_version" : "7.3.1",
    "minimum_wire_compatibility_version" : "5.6.0",
    "minimum_index_compatibility_version" : "5.0.0"
  },
  "tagline" : "You Know, for Search"
}
```

7. Download [Kibana](https://www.elastic.co/products/kibana) to your Linux VM.  From the Linux Command line:
```
curl -L -O https://artifacts.elastic.co/downloads/kibana/kibana-7.9.3-linux-x86_64.tar.gz
```
8. Extract Kibana from the gzipped tar file.
```
tar xzvf kibana-7.9.3-linux-x86_64.tar.gz
```
9. Change to the downloaded Kibana directory.
```
cd kibana-7.9.3-linux-x86_64/
```
10. Start Kibana in the background.
```
./bin/kibana &
```

Wait until you see a log line like this
```
  log   [22:20:31.804] [info][server][Kibana][http] http server running at http://localhost:5601
  ```
on your screen and then hit your RETURN key until you see the normal Linux prompt.
11. First, make sure that your Linux VM is listening for network traffic on port 5601:
```
netstat -an | grep 5601 | grep LISTEN
```
You should see something that looks similar to this:
```
tcp       0      0  *.5601                 *.*                    LISTEN     
```

Next, test Kibana from your computer's browser.  http://YOURPUBLICIP:5601

Replace "YOURPUBLICIP" with the actual Public IP for your VM instance.

Hint: your Public IP will NOT be an address that starts with 10, 172, or 192.  If you have an IP that starts with one of those numbers, that is your Private IP.  Go back a step and read the instructions carefully before proceeding.

12. Now, you need to install Beats to ingest data from various sources and then send to Elasticsearch.  For this activity, we will install Metricbeat to capture metrics from our system.  As described earlier, you could install other Beats to capture other data.

13. Download MetricBeat.
```
curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.9.3-amd64.deb
```
14. Install MetricBeat.
```
sudo dpkg -i metricbeat-7.9.3-amd64.deb

```
15. Enable the System metric data collection module.
```
sudo metricbeat modules enable system
```
If you get a notice that "Module system is already enabled", then just move to the next step.
16. Configure Metricbeat's initial configurations for the Kibana dashboards
```
sudo metricbeat setup -e
```
17. Start Metricbeat, which will start sending system metrics to Kibana.
```
sudo service metricbeat start
```
18. Open [Kibana]( http://YOURPUBLICIP:5601/app/kibana#/dashboard/Metricbeat-system-overview-ecs) in your computer's web browser.  Be sure to replace YOURPUBLICIP with the actual public IP address for your VM.

19.

## Instructions for RedHat/Amazon Linux/Fedora/CentOS

1. Download Java to your Linux machine.  OpenJDK 14 or 15 are required.  
***Note: If you do not have wget installed, use ```sudo yum install wget```***<br>
```
wget https://download.java.net/java/GA/jdk14.0.2/205943a0976c4ed48cb16f1043c5c647/12/GPL/openjdk-14.0.2_linux-x64_bin.tar.gz
```
2. Move the Java installer to /usr/local/bin
```
sudo mv openjdk-14*_bin.tar.gz /usr/local/bin/
```
3. Switch to the /usr/local/bin directory
```
cd /usr/local/bin
```
4. Extract the Java installer.
```
tar -xvf openjdk-14*_bin.tar.gz
```
5. Go inside the JDK bin directory.
```
cd openjdk-14.0.2/bin/
```
6. Run the Java command
```
./java -version
```
7. Ensure that /usr/local/bin is in your PATH
```
echo $PATH
```
If you see something similar to this, then move to the next step - you can skip over the rest of this step: ```/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin```

If you do not see /usr/local/bin, then open your user profile (~/.bashrc) and add the following:
```
export PATH=/usr/local/bin:$PATH
```
If you don't have this file in your home directory, then create it.<br>
After the profile has been saved, reload your profile.
```
source .bashrc
```
<br>
Verify that the path has /usr/local/bin in it using ```echo $PATH```
<br>
Verify that the correct java is being used:<br>
```
which java
```
You should see version 14.

8. Download Elasticsearch
```
curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-x86_64.rpm
```
Note: if you do not have curl installed, use ```sudo yum install curl```.<br>
3. Install Elasticsearch
```
sudo rpm -i elasticsearch-7.9.3-x86_64.rpm
```
4. Start elasticsearch
```
sudo service elasticsearch start
```
# TO BE FINISHED
